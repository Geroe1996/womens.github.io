/*! acrum 0.3.0 */

(function(){var e,n,t,o,r,i=[].slice;t=function(){return"undefined"!=typeof module&&null!==module&&!("undefined"!=typeof window&&null!==window?window.module:void 0)},r=function(){var e,n,o;return t()?(require("xmlhttprequest").XMLHttpRequest,1e3*((o=process.hrtime())[0]+o[1]/1e9)):null!=(e=null!=(n=window.performance)&&"function"==typeof n.now?n.now():void 0)?e:+new Date},new Date,n=function(){var e,n,t,o,r,u,a;for(e=arguments[0],n=0,o=(u=2<=arguments.length?i.call(arguments,1):[]).length;n<o;n++){r=u[n];for(t in r)a=r[t],e[t]=a}return e},(o=function(){var e,n;if(e=1<=arguments.length?i.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console&&null!=(n=console.log)?n.call:void 0))return console.log.apply(console,e)}).error=function(){var e,n;if(e=1<=arguments.length?i.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console&&null!=(n=console.error)?n.call:void 0))return console.error.apply(console,e)},e=function(){var e,i,u,a,l,d,c,f,s,m,w,p,g,v,y,h,L,S,q,K,O,x,P,b,M,A,H,R,T,E,X,C,D;if(m={host:"https://rum.serv-ac.com",maxInterval:5e3,aggregationInterval:400,decimalPrecision:3,sendLatency:!1,sample:1,active:!0},X={},!t()&&(e="function"==typeof document.querySelector?document.querySelector("[acrum-ds], [acrum-perf], [acrum-state]"):void 0))for(X={host:e.getAttribute("acrum-ds")&&""!==e.getAttribute("acrum-ds")?e.getAttribute("acrum-ds"):m.host,pageStateKey:!e.getAttribute("acrum-state")||e.getAttribute("acrum-state"),pagePerformanceKey:e.getAttribute("acrum-perf")},v=0,S=(b=["pagePerformanceKey","pageStateKey"]).length;v<S;v++)"true"===(null!=(M=X[h=b[v]])?M.toString().toLowerCase():void 0)||""===X[h]?X[h]=!0:"false"===(null!=(A=X[h])?A.toString().toLowerCase():void 0)&&(X[h]=null);return x=n({},m,X),i=x.active,(C=function(){return i=x.active&&Math.random()<x.sample})(),l=window.performance.timing.navigationStart,a=[],u={},E=function(e){return n(x,e),("sample"in e||"active"in e)&&C(),x},P={},y=!1,c=function(){return P={}},w=function(e,n){if(i)return P[e]=n,s()},R=null,O=null,p=function(){return clearTimeout(R),clearTimeout(O),O=setTimeout(p,x.maxInterval),R=null,H()},g={},T=function(e){return g=e},d=function(){return g={}},s=function(){if(clearTimeout(R),R=setTimeout(p,x.aggregationInterval),null==O)return O=setTimeout(p,x.maxInterval)},K=function(e,n){var o,i,u,a,l,d,c,f,s,m;i=t()||window.XMLHttpRequest&&(window.XMLHttpRequest.defake||"withCredentials"in new window.XMLHttpRequest),f=!!t()||(!(a=/^(https?:\/\/[^\/]+)/i.exec(x.host))||a[1]===document.location.protocol+"//"+document.location.host),s=r(),o={};for(l in e)m=e[l],o[l]=m;(c=f||i||null==("undefined"!=typeof window&&null!==window?window.XDomainRequest:void 0)?new(null!=(d="undefined"!=typeof window&&null!==window?window.XMLHttpRequest:void 0)?d:XMLHttpRequest):new window.XDomainRequest).acrum={track:!1},c.open("POST",x.host+"/v1/send",!0),c.setRequestHeader("Content-Type","application/json");for(l in n)u=n[l],c.addEventListener(l,u,!1);for(l in g)u=g[l],c.addEventListener(l,u,!1);return c.addEventListener("load",function(){return D(r()-s)},!1),c.send(JSON.stringify(o)),c},y=!1,H=function(){var e,n,t,r;if(i)if(y)o("Sending in progress, aborting");else{if(0!==Object.keys(P).length){(t={}).protocol=location.protocol.toString().replace(":",""),t.hostname=location.hostname,t.path=location.pathname,t.args=location.search,t.userAgent=navigator.userAgent.toString(),"undefined"!=typeof acrum_extra&&null!==acrum_extra&&(t.extra=acrum_extra);for(h in P)r=P[h],a.push({key:h,value:r}),t[h]=r;return n=function(e){return y=!1,P={}},e=function(e){return y=!1},y=!0,K(t,{load:n,error:e})}o("Queue Empty")}else o("Would send acrum queue")},L=!1,D=function(e){if(x.sendLatency&&!L)return w("acrum.latency",e),L=!0,setTimeout(function(){return L=!1},3e5)},q=function(e){var n,t,f,s,m,g,v;null==e&&(e=""),g=!1,m=!1,s=!1,f=function(n){return null==n&&(n=""),(h=null!=e?e:"")&&n&&(h+="."),n&&(h+=n),q(h)},n={send:function(e,n){if(null!=n&&null!=e)return w(e,n);o.error("Can't log "+e+":"+n)},now:r,sendOnStart:function(e){var n;return null!=("undefined"!=typeof window&&null!==window&&null!=(n=window.performance)?n.timing:void 0)&&(!g&&(e&&!0!==e||(e="events"),u.start=0,w(e,u),g=!0))},sendOnDOMLoad:function(e){var n,o;return null!=("undefined"!=typeof window&&null!==window&&null!=(n=window.performance)?n.timing:void 0)&&(!m&&(e&&!0!==e||(e="events"),"uninitialized"===(o=document.readyState)||"loading"===o?("function"==typeof window.addEventListener&&window.addEventListener("DOMContentLoaded",function(n){return function(){if(u.domload=(window.performance.timing.domLoading-l)/1e3,w.call(n,e,u),x.pagePerformanceKey)return t.call(n,x.pagePerformanceKey)}}(this),!1),m=!0):void 0))},sendOnLoad:function(e){var n,o;return null!=("undefined"!=typeof window&&null!==window&&null!=(n=window.performance)?n.timing:void 0)&&(!s&&(e&&!0!==e||(e="events"),"uninitialized"===(o=document.readyState)||"loading"===o?("function"==typeof window.addEventListener&&window.addEventListener("load",function(n){return function(){if(u.finished=(window.performance.timing.domComplete-l)/1e3,w.call(n,e,u),x.pagePerformanceKey)return t.call(n,x.pagePerformanceKey)}}(this),!1),s=!0):void 0))},getPagePerformance:t=function(e){var n,t,o,r,i;if(null==("undefined"!=typeof window&&null!==window&&null!=(o=window.performance)?o.timing:void 0))return!1;e&&!0!==e||(e="performance"),t={},r=window.performance.timing;for(n in r)"number"==typeof(i=r[n])&&0!==i&&(t[n]=(i-l)/1e3);return w(e,t),!0},flush:p,clearQueue:c,setHandlers:T,isSending:y,clearHandlers:d,setOptions:E,options:x,history:a,active:i};for(h in n)v=n[h],f[h]=v;return f},f=q(),x.pageStateKey&&(f.sendOnStart(x.pageStateKey),f.sendOnDOMLoad(x.pageStateKey)),(x.pageStateKey||x.pagePerformanceKey)&&f.sendOnLoad(x.pageStateKey),f},"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():window.Acrum=e()}).call(this);